<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aviation Tools by Babaeff</title>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.webmanifest">

<!-- Icons -->
<link rel="icon" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<meta name="theme-color" content="#0f172a">

<style>
    body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: radial-gradient(circle at 30% 30%, #1e293b, #0f172a);
        color: #e2e8f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        text-align: center;
    }

    h1 {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 35px;
        color: #38bdf8;
        text-shadow: 0 0 12px #38bdf880;
    }

    .container {
        display: flex;
        flex-direction: column;
        gap: 18px;
        width: 100%;
        max-width: 360px;
    }

    .btn {
        display: block;
        padding: 18px 22px;
        border-radius: 14px;
        text-decoration: none;
        font-size: 17px;
        font-weight: 600;
        color: #e0f2fe;
        background: rgba(56,189,248,0.18);
        border: 1px solid rgba(255,255,255,0.1);
        backdrop-filter: blur(6px);
        box-shadow: 0 4px 18px rgba(0,0,0,0.35);
        transition: all 0.2s ease;
    }

    .btn:hover {
        background: rgba(56,189,248,0.30);
        transform: scale(1.04);
    }

    #installBtn {
        margin-top: 25px;
        padding: 14px 20px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 700;
        background: #38bdf8;
        color: #0f172a;
        border: none;
        cursor: pointer;
        display: none;
    }

    #installBtn:hover {
        background: #5fd4ff;
    }

    footer {
        margin-top: 40px;
        font-size: 12px;
        opacity: 0.6;
    }
</style>
</head>

<body>

<h1>ğŸ‡¦ğŸ‡¿âœˆï¸ Aviation Tools</h1>

<div class="container">
    <a href="arzu/index.html" class="btn">ğŸŒª KÃ¼lÉ™k istiqamÉ™ti vÉ™ komponentlÉ™ri</a>
    <a href="converter/index.html" class="btn">ğŸš HesablayÄ±cÄ±</a>
</div>

<p id="pwaStatus" style="margin-top:18px;opacity:0.8;font-size:14px"></p>

<!-- Install Button -->
<button id="installBtn">ğŸ“² TÉ™tbiqi quraÅŸdÄ±r</button>

<footer>Â© 2025 Aviation Utility Suite</footer>

<script>
// Service Worker qeydiyyatÄ±
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
    .then(reg => console.log('Service Worker registered, scope:', reg.scope))
    .catch(err => console.error('SW registration failed:', err));
}

// INSTALL dÃ¼ymÉ™si Ã¼Ã§Ã¼n
let deferredPrompt;
const btn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", e => {
    console.log('beforeinstallprompt fired');
    e.preventDefault();
    deferredPrompt = e;
    btn.style.display = "block";
});

// Basic PWA eligibility check â€” gives feedback if something is missing
function checkPWAEligibility(){
    const status = document.getElementById('pwaStatus');

    // 1) check service worker registered
    navigator.serviceWorker.getRegistration().then(reg => {
        if (!reg) {
            console.warn('No service worker registered');
            status.textContent = 'PWA: Service worker yoxdur â€” konsolu yoxlayÄ±n.';
            return;
        }
        // 2) check manifest availability
        fetch('manifest.webmanifest', {cache: 'no-store'})
            .then(res => {
                if (!res.ok) throw new Error('manifest 404');
                return res.json();
            })
            .then(man => {
                console.log('Manifest loaded', man);
                status.textContent = 'PWA: UyÄŸunluq yoxlanÄ±ldÄ± â€” yÃ¼klÉ™yin dÃ¼ymÉ™si gÃ¶rÃ¼nmÉ™lidir.';
            })
            .catch(err => {
                console.error('Manifest problem', err);
                status.textContent = 'PWA: manifest.webmanifest tapÄ±lmadÄ± vÉ™ ya sÉ™hvdir.';
            });
    });
}

// Run check after load
window.addEventListener('load', checkPWAEligibility);

// Debug helper: add ?debugInstall=1 to force the install button visible (useful on localhost)
function showInstallButtonForDebug(){
    try {
        const params = new URLSearchParams(window.location.search);
        if (params.get('debugInstall') === '1'){
            console.log('Debug: forcing install button visible via URL flag');
            const b = document.getElementById('installBtn');
            if (b) b.style.display = 'block';
            const s = document.getElementById('pwaStatus');
            if (s) s.textContent = 'PWA: Debug â€” install button forced visible';
        }
    } catch(e){ console.warn('debugInstall parse error', e); }
}
showInstallButtonForDebug();

btn.addEventListener("click", () => {
    console.log('install button clicked');
    if (!deferredPrompt) return console.warn('No deferredPrompt available');
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(choice => console.log('User response to install prompt:', choice))
        .catch(err => console.error('Error showing install prompt:', err));
    deferredPrompt = null;
    btn.style.display = "none";
});

/* Feedback when app is installed */
window.addEventListener('appinstalled', () => {
    console.log('PWA installed');
    const status = document.getElementById('pwaStatus');
    if (status) status.textContent = 'PWA: QuraÅŸdÄ±rÄ±ldÄ± â€” alqÄ±ÅŸ! ğŸ‰';
});
</script>

</body>
</html>
